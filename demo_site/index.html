<html>
<head>
  <link href="CSS/index.css" rel="stylesheet">
  <link href="jquery-ui-1.11.2.custom/jquery-ui.css" rel="stylesheet">
  <script src="jquery-ui-1.11.2.custom/external/jquery/jquery.js"></script>
  <script src="jquery-ui-1.11.2.custom/jquery-ui.js"></script>
  <script src="Scripts/createCostDiv.js"></script>
  <script src="Scripts/createBankDiv.js"></script>
  <script src="Scripts/utils.js"></script>
</head>
<body>
<h1>Pathfinder Online "Official Data" Viewer</h1>

<form id='entitySelect'>
<label for="autocomplete">Select an Entity: </label>
<input id="autocomplete" name='entity'>
<div id='formRankDiv'>
<label for="rankSelector">Enter Rank, if any: </label>
<input id="rankSelector" type='text' name='rank' maxlength="2">
<input id="submitBut" type='submit' text="Submit">
</div>
</form>

<div id='planDiv'>
</div>

<script type="text/javascript">

  var plan;

  $('#autocomplete').autocomplete({
      source: function(request, response) {
          $.ajax({
              url: '/entities',
              type: 'POST',
              dataType: 'json',
              data: { search: request.term },
              success: function(data) {
                 response($.map(data, function(entity) {
                    return { label: entity, value: entity }
                 }));
              }
          });
      },
      minLength: 1
  });

  $('#entitySelect').submit(function() {
     var postData = { Entity: $("input[name='entity']").val(), Rank: $("input[name='rank']").val(), Store: 'default', Tracked: 'default' };
     $.ajax({
        url: '/plan',
        type: 'POST',
        data: postData,
        dataType: 'json',
        success: function(data) {
           plan = data;
           $('#planDiv').empty();
           CreateCostDiv(plan[0].Cost).appendTo('#planDiv');
           CreateBankDiv(plan[0].Bank).appendTo('#planDiv');
        },
        error: function(jqXHR, textStatus, errorThrown) {
           console.log("Ajax error: " + textStatus + "; " + errorThrown);
        }
     });
     return false;
  });

  $(function() {
     // handler for .ready() called
  });
</script>

</body>
</html>
